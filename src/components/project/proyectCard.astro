---
import { FaGithub, FaYoutube } from "react-icons/fa";
import { FaItchIo } from "react-icons/fa6";
import { HiExternalLink } from "react-icons/hi";
import { detectPlatform } from "../../utils/linkUtils.js";

export interface Props {
  titulo: string;
  descripcion: string;
  imagen: string;
  gif?: string;
  tecnologias: string[];
  roles?: string[];
  awards?: string[];
  links?: string[];
  categoria?: string;
  index: number;
}

const { titulo, descripcion, imagen, gif, tecnologias, roles, awards, links, categoria, index } =
  Astro.props;

const parsedLinks = (links || []).map((url) => ({ url, ...detectPlatform(url) }));
---

<div
  data-index={index}
  data-categoria={categoria ?? ""}
  class="group/card project-card z-10 flex w-[400px] flex-col overflow-hidden rounded-lg bg-gray-900 shadow-lg transition-transform hover:scale-[1.01] lg:w-[320px] drop-shadow-[4px_4px_0_#7836cf]"
>
  <div class="relative overflow-hidden">
    <img
      src={gif || imagen}
      alt={`Project: ${titulo}`}
      class="h-50 w-full rounded-2xl object-cover p-3"
    />
    {imagen && gif && (
      <img
        src={imagen}
        alt={`Project: ${titulo}`}
        class="absolute inset-0 h-full w-full rounded-2xl object-cover p-3 transition-opacity duration-300 group-hover/card:opacity-0"
      />
    )}
  </div>
  <div class="flex grow flex-col px-3 pb-3">
    <h3 class="text-xl font-semibold text-white drop-shadow-[1px_1px_0_#7836cf]">{titulo}</h3>

    <div class="my-1.5 flex flex-wrap gap-2">
      {
        tecnologias.map((tech) => (
          <span class="rounded-md bg-[#7836cf]/20 text-[#a27ed1] px-2 py-0.5 text-xs font-semibold">
            {tech}
          </span>
        ))
      }
      {
        roles && roles.map((role) => (
          <span class="rounded-md bg-[#69c7c7]/20 text-[#69c7c7] px-2 py-0.5 text-xs font-semibold">
            {role}
          </span>
        ))
      }
      {
        awards && awards.map((award) => (
          <span class="rounded-md bg-yellow-500/20 text-yellow-400 px-2 py-0.5 text-xs font-semibold">
            ğŸ† {award}
          </span>
        ))
      }
    </div>

    <p class="flex grow text-gray-400">{descripcion}</p>

    <div class="mt-auto flex flex-wrap gap-4">
      {parsedLinks.map((link) => (
        <a
          class="group text-primary mt-6 flex items-center justify-start p-0 font-bold text-lg"
          target="_blank"
          rel="noopener noreferrer"
          href={link.url}
        >
          {link.platform === "itch" && <FaItchIo className="mr-1.5" size={18} />}
          {link.platform === "github" && <FaGithub className="mr-1.5" size={18} />}
          {link.platform === "youtube" && <FaYoutube className="mr-1.5" size={18} />}
          {link.platform === "link" && <HiExternalLink className="mr-1.5" size={18} />}
          {link.label}
        </a>
      ))}
    </div>
  </div>
</div>
